<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà üéâ</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        :root {
            --primary: #e74c3c;
            --primary-dark: #c0392b;
            --secondary: #f39c12;
            --secondary-light: #f1c40f;
            --success: #27ae60;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --purple: #9b59b6;
            --blue: #3498db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #feca57 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            position: relative;
            padding-bottom: 80px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ FAB ‡∏ö‡∏±‡∏á */
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Floating particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.6;
            animation: float 10s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-100px) rotate(180deg); }
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            width: 95%;
            max-width: 650px;
            border-radius: 30px;
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.3),
                0 0 0 1px rgba(255,255,255,0.5) inset;
            padding: 30px;
            position: relative;
            min-height: 85vh;
            display: flex;
            flex-direction: column;
            z-index: 10;
            animation: slideIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            margin-bottom: 20px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, var(--primary), var(--secondary)) 1;
            position: relative;
        }

        #app-logo {
            width: 100px;
            height: 100px;
            margin-bottom: 15px;
            border-radius: 50%;
            border: 4px solid var(--secondary);
            object-fit: cover;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: logoFloat 3s ease-in-out infinite;
            transition: transform 0.3s;
        }

        #app-logo:hover {
            transform: scale(1.1) rotate(5deg);
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 10px 0;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            font-size: 1rem;
            color: #7f8c8d;
            font-weight: 400;
        }

        h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h3 i {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Page Transitions */
        .page {
            display: none;
            animation: fadeInUp 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .page.active { display: block; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Forms & Inputs */
        input, textarea, select {
            width: 100%;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            font-family: 'Prompt', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(231, 76, 60, 0.1);
            transform: translateY(-2px);
        }

        /* Buttons */
        button {
            width: 100%;
            padding: 15px 25px;
            margin: 8px 0;
            border-radius: 15px;
            border: none;
            font-family: 'Prompt', sans-serif;
            font-weight: 600;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:active::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(-1px);
        }

        .primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .secondary {
            background: linear-gradient(135deg, var(--dark), #34495e);
            color: white;
        }

        .gold {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
            color: white;
        }

        .outline {
            background: transparent;
            border: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 700;
        }

        .outline:hover {
            background: var(--primary);
            color: white;
        }

        /* Cards & Lists */
        .list-container {
            max-height: 320px;
            overflow-y: auto;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            background: #fafafa;
        }

        .list-container::-webkit-scrollbar {
            width: 8px;
        }

        .list-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .list-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .list-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }

        .list-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .list-item input[type="checkbox"] {
            width: auto;
            margin-right: 12px;
            cursor: pointer;
            width: 20px;
            height: 20px;
        }

        /* Tab System */
        .tab-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .tab-buttons button {
            padding: 12px;
            font-size: 0.95rem;
        }

        /* Modal Tab System */
        .modal-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .modal-tabs button {
            padding: 12px;
            font-size: 0.95rem;
            background: #ecf0f1;
            color: var(--dark);
        }

        .modal-tabs button.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .modal-tab-content {
            display: none;
        }

        .modal-tab-content.active {
            display: block;
        }

        /* Draw Page Special Styles */
        .draw-button {
            width: 200px !important;
            height: 200px !important;
            border-radius: 50% !important;
            font-size: 1.8rem !important;
            margin: 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            box-shadow: 
                0 0 30px rgba(245, 87, 108, 0.5),
                0 10px 40px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
            position: relative;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 30px rgba(245, 87, 108, 0.5);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 50px rgba(245, 87, 108, 0.8);
            }
        }

        .draw-button:hover {
            transform: scale(1.1) !important;
            animation: none;
        }

        /* Result Display */
        .result-box {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 30px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            padding: 0 10px;
            line-height: 1.3;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .name-letter {
            display: inline-block;
            margin: 0 2px;
            transition: all 0.3s;
        }

        .name-letter.blur {
            filter: blur(8px);
            opacity: 0.5;
        }

        .name-letter.reveal {
            animation: letterReveal 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes letterReveal {
            0% { transform: scale(0) rotate(-180deg); filter: blur(10px); }
            100% { transform: scale(1) rotate(0deg); filter: blur(0); }
        }

        /* Mission Box */
        .mission-box {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(253, 203, 110, 0.4);
            display: none;
            animation: slideInUp 0.5s;
            text-align: center;
        }

        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .mission-box small {
            display: block;
            color: #e17055;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .mission-box .mission-text {
            font-size: 1.5rem;
            color: var(--dark);
            font-weight: 700;
            display: block;
            margin-top: 10px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        /* Hint Text Style */
        .hint-text {
            font-size: 1.3rem;
            color: var(--dark);
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            line-height: 1.6;
            word-wrap: break-word;
            animation: bounceIn 0.6s;
        }

        .hint-text .consonants {
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--primary);
            display: block;
            margin: 10px 0;
            letter-spacing: 3px;
        }

        /* Options Container */
        .options-container {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .options-container label {
            display: flex;
            align-items: center;
            margin: 10px 0;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s;
        }

        .options-container label:hover {
            transform: translateX(5px);
        }

        .options-container input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            cursor: pointer;
        }

        /* FAB - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
        }

        .fab {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--secondary), var(--secondary-light));
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s;
        }

        .fab:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
        }

        .fab-qr {
            background: linear-gradient(135deg, var(--blue), var(--purple));
        }

        .fab-qr:hover {
            transform: scale(1.1) rotate(-15deg);
        }

        /* Modal */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 25px;
            width: 90%;
            max-width: 450px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: modalSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-height: 85vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.7) translateY(-50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            cursor: pointer;
            color: #95a5a6;
            transition: all 0.3s;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            z-index: 10;
        }

        .close-btn:hover {
            color: var(--primary);
            background: rgba(231, 76, 60, 0.1);
            transform: rotate(90deg);
        }

        /* QR Code Container */
        #qrcode-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        #qrcode {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .share-url {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 15px 0;
            border: 2px dashed var(--primary);
        }

        /* Animation Container */
        #tao-animation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #tao-image {
            max-width: 90%;
            max-height: 60vh;
            animation: shake 0.1s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .animation-text {
            color: white;
            font-size: 2rem;
            margin-top: 30px;
            font-weight: 700;
            animation: glow 1s infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px #fff, 0 0 30px #f39c12; }
            50% { text-shadow: 0 0 40px #fff, 0 0 60px #f39c12; }
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--secondary);
            position: fixed;
            top: -10px;
            z-index: 9999;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Status Summary */
        .status-summary {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            gap: 15px;
        }

        .status-card {
            flex: 1;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .status-card.success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
        }

        .status-card.danger {
            background: linear-gradient(135deg, #ee0979, #ff6a00);
        }

        .status-card b {
            font-size: 2rem;
            display: block;
            margin-top: 10px;
        }

        /* Utilities */
        .hidden { display: none !important; }
        .text-center { text-align: center; }

        footer {
            margin-top: auto;
            text-align: center;
            font-size: 0.85rem;
            color: #95a5a6;
            padding-top: 25px;
            border-top: 2px dashed #e0e0e0;
        }

        /* Responsive - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        @media (max-width: 600px) {
            body {
                padding-bottom: 100px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            }
            
            .container { 
                padding: 20px;
                margin-bottom: 30px;
            }
            
            h1 { font-size: 1.5rem; }
            .result-box { font-size: 2rem; }
            .hint-text { font-size: 1.1rem; }
            .hint-text .consonants { font-size: 1.5rem; }
            .mission-box .mission-text { font-size: 1.2rem; }
            
            .draw-button {
                width: 170px !important;
                height: 170px !important;
                font-size: 1.5rem !important;
            }

            /* ‡∏õ‡∏£‡∏±‡∏ö FAB ‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            .fab-container {
                bottom: 15px;
                right: 15px;
                gap: 10px;
            }

            .fab, .fab-qr {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            /* ‡∏õ‡∏£‡∏±‡∏ö Modal ‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            .modal-content {
                width: 95%;
                padding: 20px;
                max-height: 90vh;
            }

            .modal-tabs {
                gap: 8px;
            }

            .modal-tabs button {
                padding: 10px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Elements ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ -->
    <audio id="sound-click" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-drumroll" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2573/2573-preview.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-fanfare" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-reveal" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" type="audio/mpeg">
    </audio>

    <!-- Floating Particles Background -->
    <div class="particles" id="particles-container"></div>

    <div class="container">
        <header>
            <img id="app-logo" src="https://img5.pic.in.th/file/secure-sv1/-27d109079d78fadd36.png" alt="Logo">
            <h1 id="app-title">üéä ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà üéä</h1>
            <h2 id="current-profile-name">-</h2>
        </header>

        <!-- Login Page -->
        <div id="page-login" class="page active">
            <h3><i class="fas fa-users-cog"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h3>
            <p style="margin-bottom: 20px; color: #7f8c8d;">‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°</p>
            <input type="text" id="profile-input" placeholder="üè∑Ô∏è ‡πÄ‡∏ä‡πà‡∏ô M.Ed 68 Room 1">
            <button class="primary" onclick="loginProfile()">
                <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </button>
            
            <div style="margin-top: 30px; border-top: 2px dashed #e0e0e0; padding-top: 20px; text-align: center;">
                <small style="color: #95a5a6;">
                    <i class="fas fa-code"></i> ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏£‡∏π‡∏ô‡∏ô‡∏ó‡∏û‡∏±‡∏ó‡∏ò‡πå ‡∏´‡∏¥‡∏£‡∏±‡∏ç‡πÄ‡∏£‡∏∑‡∏≠‡∏á
                </small>
            </div>
        </div>

        <!-- Setup Page -->
        <div id="page-setup" class="page">
            <h3><i class="fas fa-list"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ & ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</h3>
            
            <div class="tab-buttons">
                <button onclick="switchTab('tab-names')" class="secondary">
                    <i class="fas fa-user-friends"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
                </button>
                <button onclick="switchTab('tab-missions')" class="secondary">
                    <i class="fas fa-tasks"></i> ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                </button>
                <button onclick="switchTab('tab-settings')" class="secondary">
                    <i class="fas fa-cog"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
            </div>

            <div id="tab-names">
                <textarea id="bulk-names" rows="5" placeholder="üìù ‡∏ß‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ï‡πà‡∏≠ 1 ‡∏ä‡∏∑‡πà‡∏≠) ‡∏´‡∏£‡∏∑‡∏≠ Copy ‡∏à‡∏≤‡∏Å Excel ‡∏°‡∏≤‡∏ß‡∏≤‡∏á"></textarea>
                <button onclick="addNames()" class="gold">
                    <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
                </button>
                <div class="list-container" id="preview-names-list"></div>
            </div>

            <div id="tab-missions" class="hidden">
                <input type="text" id="mission-input" placeholder="üéØ ‡∏£‡∏∞‡∏ö‡∏∏‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à ‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á 1 ‡πÄ‡∏û‡∏•‡∏á">
                <button onclick="addMission()" class="gold">
                    <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                </button>
                <div class="list-container" id="mission-list-display"></div>
            </div>

            <div id="tab-settings" class="hidden">
                <label style="font-weight: 600; display: block; margin-top: 10px;">
                    <i class="fas fa-heading"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö:
                </label>
                <input type="text" id="setting-title-input">
                
                <label style="font-weight: 600; display: block; margin-top: 15px;">
                    <i class="fas fa-image"></i> ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏•‡πÇ‡∏Å‡πâ (URL):
                </label>
                <input type="text" id="setting-logo-input">
                
                <button onclick="saveSettings()" class="primary">
                    <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
            </div>

            <button onclick="goToPage('page-check')" class="primary" style="margin-top: 20px;">
                ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <!-- Check Page -->
        <div id="page-check" class="page">
            <h3><i class="fas fa-user-check"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å</h3>
            <p style="margin-bottom: 15px; color: #7f8c8d;">
                ‚úì ‡∏ï‡∏¥‡πä‡∏Å‡∏≠‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
            </p>
            
            <div class="list-container" id="check-list-container"></div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="goToPage('page-setup')" class="secondary">
                    <i class="fas fa-arrow-left"></i> ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                </button>
                <button onclick="goToPage('page-draw')" class="primary">
                    ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å! <i class="fas fa-gift"></i>
                </button>
            </div>
        </div>

        <!-- Draw Page -->
        <div id="page-draw" class="page">
            <div class="text-center">
                <h3><i class="fas fa-random"></i> ‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å</h3>
                
                <div class="options-container">
                    <label>
                        <input type="checkbox" id="opt-remove-drawn" checked>
                        <span>üóëÔ∏è ‡∏ï‡∏±‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≠‡∏Å</span>
                    </label>
                    <label>
                        <input type="checkbox" id="opt-enable-missions">
                        <span>üéØ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏£‡∏≠‡∏ö‡∏û‡∏¥‡πÄ‡∏®‡∏©</span>
                    </label>
                </div>

                <button class="draw-button" onclick="startDraw()">
                    <div style="text-align: center;">
                        <i class="fas fa-dice" style="display: block; font-size: 2.5rem; margin-bottom: 10px;"></i>
                        <span>‡∏Å‡∏î‡∏™‡∏∏‡πà‡∏°!</span>
                    </div>
                </button>

                <div id="reveal-controls" class="hidden">
                    <p style="font-size: 1.2rem; color: var(--success); font-weight: 600; margin-bottom: 20px;">
                        üéâ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß! üéâ
                    </p>
                    
                    <!-- Mission Display (‡πÅ‡∏™‡∏î‡∏á‡∏Å‡πà‡∏≠‡∏ô) -->
                    <div class="mission-box" id="result-mission-box">
                        <small>üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏û‡∏¥‡πÄ‡∏®‡∏©</small>
                        <span class="mission-text" id="result-mission-text"></span>
                    </div>

                    <!-- Hint Display (‡πÄ‡∏ú‡∏¢‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞) -->
                    <div class="hint-text hidden" id="hint-display">
                        ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏µ
                        <span class="consonants" id="consonants-display"></span>
                        ‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠
                    </div>
                    
                    <!-- Name Result Display -->
                    <div class="result-box hidden" id="result-name-placeholder"></div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 25px;">
                        <button onclick="revealInitial()" class="outline" id="btn-reveal-consonants">
                            <i class="fas fa-eye"></i> ‡πÄ‡∏ú‡∏¢‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞
                        </button>
                        <button onclick="revealFull()" class="gold" id="btn-reveal-full">
                            <i class="fas fa-star"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á!
                        </button>
                    </div>
                    
                    <button onclick="resetDrawUI()" class="secondary" style="margin-top: 15px;">
                        <i class="fas fa-redo"></i> ‡∏õ‡∏¥‡∏î / ‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
            </div>
            
            <button onclick="goToPage('page-check')" class="secondary" style="margin-top: auto;">
                <i class="fas fa-edit"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
            </button>
        </div>

        <footer>
            <p>
                <i class="fas fa-heart" style="color: #e74c3c;"></i>
                ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏£‡∏π‡∏ô‡∏ô‡∏ó‡∏û‡∏±‡∏ó‡∏ò‡πå ‡∏´‡∏¥‡∏£‡∏±‡∏ç‡πÄ‡∏£‡∏∑‡∏≠‡∏á
                <i class="fas fa-heart" style="color: #e74c3c;"></i>
            </p>
        </footer>
    </div>

    <!-- FAB Buttons Container -->
    <div class="fab-container">
        <div class="fab fab-qr" onclick="toggleQRModal()" title="QR Code">
            <i class="fas fa-qrcode"></i>
        </div>
        <div class="fab" onclick="toggleStatusModal()" title="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞">
            <i class="fas fa-clipboard-list"></i>
        </div>
    </div>

    <!-- Status Modal -->
    <div id="status-modal" class="overlay">
        <div class="modal-content">
            <span class="close-btn" onclick="toggleStatusModal()">&times;</span>
            <h3 style="margin-bottom: 20px;">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h3>
            
            <div class="status-summary">
                <div class="status-card success">
                    <span>‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
                    <b id="count-drawn">0</b>
                </div>
                <div class="status-card danger">
                    <span>‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                    <b id="count-left">0</b>
                </div>
            </div>

            <!-- Modal Tabs -->
            <div class="modal-tabs">
                <button onclick="switchModalTab('drawn-tab')" class="active" id="tab-btn-drawn">
                    <i class="fas fa-check-circle"></i> ‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß
                </button>
                <button onclick="switchModalTab('remaining-tab')" id="tab-btn-remaining">
                    <i class="fas fa-user-clock"></i> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏±‡∏ö
                </button>
            </div>

            <!-- Tab Content: ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß -->
            <div id="drawn-tab" class="modal-tab-content active">
                <div class="list-container" id="drawn-history-list"></div>
            </div>

            <!-- Tab Content: ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏±‡∏ö -->
            <div id="remaining-tab" class="modal-tab-content">
                <div class="list-container" id="remaining-list"></div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qr-modal" class="overlay">
        <div class="modal-content">
            <span class="close-btn" onclick="toggleQRModal()">&times;</span>
            <h3 style="margin-bottom: 20px; text-align: center;">
                <i class="fas fa-qrcode"></i> ‡πÅ‡∏ä‡∏£‡πå‡∏£‡∏∞‡∏ö‡∏ö QR Code
            </h3>
            
            <div id="qrcode-container">
                <p style="color: #7f8c8d; margin-bottom: 15px; text-align: center;">
                    ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                </p>
                <div id="qrcode"></div>
                <div class="share-url" id="share-url"></div>
                <button onclick="copyURL()" class="gold" style="margin-top: 15px;">
                    <i class="fas fa-copy"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå
                </button>
            </div>
        </div>
    </div>

    <!-- Animation Container -->
    <div id="tao-animation-container">
        <img id="tao-image" src="" alt="Animation">
        <div class="animation-text">üéä ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å... üéä</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update, push, child, remove } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA45AAd4b2GG0ks-03i7K5iFS8GHc94msY",
            authDomain: "newyearsystem-f160b.firebaseapp.com",
            projectId: "newyearsystem-f160b",
            storageBucket: "newyearsystem-f160b.firebasestorage.app",
            messagingSenderId: "339812474092",
            appId: "1:339812474092:web:00ba62bd2f6bbf546a99c9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // State Variables
        let currentProfileId = localStorage.getItem('ny_profile_id') || "";
        let profileData = {};
        let currentDrawResult = null;
        let isUserLoggedIn = false;
        let audioInitialized = false;

        // DOM Elements
        const el = id => document.getElementById(id);

        // Sound System - ‡πÉ‡∏ä‡πâ HTML5 Audio ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
        const sounds = {
            click: el('sound-click'),
            drumroll: el('sound-drumroll'),
            fanfare: el('sound-fanfare'),
            reveal: el('sound-reveal')
        };

        // Initialize audio on first user interaction
        function initAudio() {
            if (audioInitialized) return;
            
            Object.values(sounds).forEach(audio => {
                audio.volume = 0.3;
                audio.load();
            });
            
            audioInitialized = true;
            console.log('Audio initialized');
        }

        function playSound(soundName) {
            if (!audioInitialized) initAudio();
            
            const audio = sounds[soundName];
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        // Initialize audio on first click
        document.addEventListener('click', initAudio, { once: true });
        document.addEventListener('touchstart', initAudio, { once: true });

        // Add click sound to all buttons
        document.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                playSound('click');
            }
        });

        // Confetti Effect
        function createConfetti() {
            const colors = ['#f39c12', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6', '#1abc9c'];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3500);
                }, i * 20);
            }
        }

        // Create Floating Particles
        function createParticles() {
            const container = el('particles-container');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDuration = Math.random() * 10 + 10 + 's';
                particle.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(particle);
            }
        }

        createParticles();

        // --- Modal Tab Functions ---
        window.switchModalTab = function(tabName) {
            // Hide all tabs
            document.querySelectorAll('.modal-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.modal-tabs button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            el(tabName).classList.add('active');
            
            if (tabName === 'drawn-tab') {
                el('tab-btn-drawn').classList.add('active');
            } else {
                el('tab-btn-remaining').classList.add('active');
            }
        }

        // --- QR Code Functions ---
        window.toggleQRModal = function() {
            const modal = el('qr-modal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                generateQRCode();
                modal.style.display = 'flex';
            }
        }

        function generateQRCode() {
            const qrcodeContainer = el('qrcode');
            const shareUrlDiv = el('share-url');
            
            qrcodeContainer.innerHTML = '';
            
            const currentURL = window.location.href.split('?')[0];
            const shareURL = currentURL + '?profile=' + encodeURIComponent(currentProfileId);
            
            shareUrlDiv.textContent = shareURL;
            
            new QRCode(qrcodeContainer, {
                text: shareURL,
                width: 256,
                height: 256,
                colorDark: '#2c3e50',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        window.copyURL = function() {
            const shareUrlDiv = el('share-url');
            const url = shareUrlDiv.textContent;
            
            navigator.clipboard.writeText(url).then(() => {
                alert('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!');
            });
        }

        function checkURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const profileParam = urlParams.get('profile');
            
            if (profileParam) {
                el('profile-input').value = profileParam;
                if (!currentProfileId && isUserLoggedIn) {
                    setTimeout(() => {
                        loginProfile();
                    }, 500);
                }
            }
        }

        // --- Auth & Init System ---
        signInAnonymously(auth).catch((error) => {
            console.error("Auth Error:", error);
            alert("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä");
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("üîí Secure Connection Established");
                isUserLoggedIn = true;
                
                checkURLParams();
                
                if (currentProfileId) {
                    const urlParams = new URLSearchParams(window.location.search);
                    if (!urlParams.get('profile')) {
                        el('profile-input').value = currentProfileId.replace(/_/g, " ");
                        loginProfile();
                    }
                }
            }
        });

        // --- Core Functions ---
        window.loginProfile = function() {
            if (!isUserLoggedIn) {
                alert("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà");
                return;
            }

            const input = el('profile-input').value.trim();
            if (!input) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå");
            
            const safeId = input.replace(/[^a-zA-Z0-9‡∏Å-‡πô]/g, "_");
            currentProfileId = safeId;
            localStorage.setItem('ny_profile_id', safeId);
            
            const profileRef = ref(db, 'profiles/' + currentProfileId);
            
            onValue(profileRef, (snapshot) => {
                const data = snapshot.val();
                if (!data) {
                    set(profileRef, {
                        settings: { 
                            title: "üéä ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà üéä",
                            logo: "https://img5.pic.in.th/file/secure-sv1/-27d109079d78fadd36.png"
                        },
                        participants: {},
                        missions: [],
                        history: {}
                    });
                } else {
                    profileData = data;
                    renderApp();
                }
            });

            goToPage('page-setup');
        }

        window.goToPage = function(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            el(pageId).classList.add('active');
            if(pageId === 'page-check' || pageId === 'page-setup') renderApp();
        }

        function renderApp() {
            if (!profileData.settings) return;

            el('app-title').innerText = profileData.settings.title;
            el('app-logo').src = profileData.settings.logo;
            el('current-profile-name').innerText = "üìÅ Profile: " + currentProfileId;
            
            el('setting-title-input').value = profileData.settings.title;
            el('setting-logo-input').value = profileData.settings.logo;

            renderParticipants();
            renderMissions();
            renderHistory();
            renderRemaining();
        }

        // --- Data Management ---
        window.addNames = function() {
            const text = el('bulk-names').value;
            if (!text) return;
            
            const lines = text.split('\n');
            const updates = {};
            
            lines.forEach(line => {
                const name = line.trim();
                if (name) {
                    const newKey = push(child(ref(db), 'profiles/' + currentProfileId + '/participants')).key;
                    updates['profiles/' + currentProfileId + '/participants/' + newKey] = {
                        name: name,
                        active: true, 
                        drawn: false
                    };
                }
            });
            
            update(ref(db), updates);
            el('bulk-names').value = "";
            alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        }

        window.addMission = function() {
            const m = el('mission-input').value.trim();
            if (!m) return;
            
            const currentMissions = profileData.missions || [];
            currentMissions.push(m);
            
            update(ref(db, 'profiles/' + currentProfileId), { missions: currentMissions });
            el('mission-input').value = "";
        }

        window.saveSettings = function() {
            update(ref(db, 'profiles/' + currentProfileId + '/settings'), {
                title: el('setting-title-input').value,
                logo: el('setting-logo-input').value
            });
            alert("üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß");
        }

        // --- Rendering Lists ---
        function renderParticipants() {
            const pList = profileData.participants || {};
            const previewContainer = el('preview-names-list');
            const checkContainer = el('check-list-container');
            
            previewContainer.innerHTML = "";
            checkContainer.innerHTML = "";
            
            let countDrawn = 0;
            let countLeft = 0;

            Object.entries(pList).forEach(([key, p]) => {
                previewContainer.innerHTML += `
                    <div class="list-item">
                        <i class="fas fa-user" style="margin-right: 10px; color: var(--primary);"></i>
                        ${p.name}
                    </div>`;
                
                if (!p.drawn) {
                    const checked = p.active ? 'checked' : '';
                    checkContainer.innerHTML += `
                        <div class="list-item">
                            <input type="checkbox" ${checked} onchange="toggleActive('${key}', this.checked)">
                            ${p.name}
                        </div>`;
                    if (p.active) countLeft++;
                } else {
                    countDrawn++;
                }
            });

            el('count-drawn').innerText = countDrawn;
            el('count-left').innerText = countLeft;
        }

        function renderMissions() {
            const mList = profileData.missions || [];
            const container = el('mission-list-display');
            container.innerHTML = "";
            mList.forEach((m, index) => {
                container.innerHTML += `
                    <div class="list-item">
                        <i class="fas fa-bullseye" style="margin-right: 10px; color: var(--secondary);"></i>
                        ${m}
                    </div>`;
            });
        }
        
        function renderHistory() {
            const hList = profileData.history || {};
            const container = el('drawn-history-list');
            container.innerHTML = "";
            const arr = Object.values(hList).reverse();
            
            if (arr.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#95a5a6; padding:20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å</p>';
                return;
            }
            
            arr.forEach(h => {
                container.innerHTML += `
                    <div class="list-item" style="flex-direction:column; align-items:flex-start;">
                        <strong style="color: var(--primary);">
                            <i class="fas fa-trophy"></i> ${h.name}
                        </strong>
                        ${h.mission ? `<small style="color: var(--secondary); margin-top: 5px;">üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${h.mission}</small>` : ''}
                    </div>`;
            });
        }

        function renderRemaining() {
            const pList = profileData.participants || {};
            const container = el('remaining-list');
            container.innerHTML = "";
            
            const remaining = Object.entries(pList).filter(([key, p]) => !p.drawn && p.active);
            
            if (remaining.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#95a5a6; padding:20px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏±‡∏ö‡∏™‡∏•‡∏≤‡∏Å</p>';
                return;
            }
            
            remaining.forEach(([key, p]) => {
                container.innerHTML += `
                    <div class="list-item">
                        <i class="fas fa-user-clock" style="margin-right: 10px; color: var(--blue);"></i>
                        ${p.name}
                    </div>`;
            });
        }

        window.toggleActive = function(key, isActive) {
            update(ref(db, 'profiles/' + currentProfileId + '/participants/' + key), { active: isActive });
        }

        window.switchTab = function(tabId) {
            el('tab-names').classList.add('hidden');
            el('tab-missions').classList.add('hidden');
            el('tab-settings').classList.add('hidden');
            el(tabId).classList.remove('hidden');
        }

        // --- Draw Logic & Animation ---
        window.startDraw = function() {
            const pList = profileData.participants || {};
            const candidates = Object.entries(pList).filter(([key, val]) => val.active && !val.drawn);
            
            if (candidates.length === 0) {
                alert("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß!");
                return;
            }

            const randomIndex = Math.floor(Math.random() * candidates.length);
            const winnerEntry = candidates[randomIndex];
            
            let mission = null;
            if (el('opt-enable-missions').checked) {
                const missions = profileData.missions || [];
                if (missions.length > 0) {
                    mission = missions[Math.floor(Math.random() * missions.length)];
                }
            }

            currentDrawResult = {
                key: winnerEntry[0],
                name: winnerEntry[1].name,
                mission: mission
            };

            playSound('drumroll');
            playTaoAnimation();
        }

        function playTaoAnimation() {
            const container = el('tao-animation-container');
            const img = el('tao-image');
            const img1 = "https://nonthaphathr.github.io/uploadimg/tao1.png";
            const img2 = "https://nonthaphathr.github.io/uploadimg/tao2.png";
            
            container.style.display = 'flex';
            let toggle = false;
            const interval = setInterval(() => {
                img.src = toggle ? img1 : img2;
                toggle = !toggle;
            }, 100);

            setTimeout(() => {
                clearInterval(interval);
                container.style.display = 'none';
                showRevealUI();
            }, 3000);
        }

        function showRevealUI() {
            el('reveal-controls').classList.remove('hidden');
            el('hint-display').classList.add('hidden');
            el('result-name-placeholder').classList.add('hidden');
            
            if (currentDrawResult.mission) {
                el('result-mission-text').innerText = currentDrawResult.mission;
                el('result-mission-box').style.display = 'block';
            } else {
                el('result-mission-box').style.display = 'none';
            }
        }

        function extractConsonants(name) {
            const consonants = [];
            
            consonants.push(name[0]);
            if (name.length > 1) {
                consonants.push(name[name.length - 1]);
            }
            
            for (let i = 3; i < name.length - 1; i += 3) {
                consonants.push(name[i]);
            }
            
            return [...new Set(consonants)].join(' ');
        }

        window.revealInitial = function() {
            if (!currentDrawResult) return;
            
            playSound('reveal');
            
            const consonants = extractConsonants(currentDrawResult.name);
            el('consonants-display').innerText = consonants;
            el('hint-display').classList.remove('hidden');
            el('hint-display').style.animation = 'none';
            setTimeout(() => {
                el('hint-display').style.animation = 'bounceIn 0.6s';
            }, 10);
        }

        window.revealFull = function() {
            if (!currentDrawResult) return;
            
            playSound('fanfare');
            createConfetti();
            
            const name = currentDrawResult.name;
            const resultBox = el('result-name-placeholder');
            resultBox.innerHTML = '';
            resultBox.classList.remove('hidden');
            
            el('hint-display').classList.add('hidden');
            
            for (let i = 0; i < name.length; i++) {
                setTimeout(() => {
                    const span = document.createElement('span');
                    span.className = 'name-letter reveal';
                    span.textContent = name[i];
                    resultBox.appendChild(span);
                }, i * 100);
            }
            
            setTimeout(() => {
                saveDrawResult();
            }, name.length * 100 + 500);
        }

        function saveDrawResult() {
            const updates = {};
            if (el('opt-remove-drawn').checked) {
                updates['profiles/' + currentProfileId + '/participants/' + currentDrawResult.key + '/drawn'] = true;
            }
            const historyKey = push(child(ref(db), 'profiles/' + currentProfileId + '/history')).key;
            updates['profiles/' + currentProfileId + '/history/' + historyKey] = {
                name: currentDrawResult.name,
                mission: currentDrawResult.mission || null,
                timestamp: Date.now()
            };
            update(ref(db), updates);
        }

        window.resetDrawUI = function() {
            el('reveal-controls').classList.add('hidden');
            el('hint-display').classList.add('hidden');
            el('result-name-placeholder').classList.add('hidden');
            currentDrawResult = null;
        }

        window.toggleStatusModal = function() {
            const m = el('status-modal');
            if (m.style.display === 'flex') {
                m.style.display = 'none';
            } else {
                renderHistory();
                renderRemaining();
                m.style.display = 'flex';
            }
        }

    </script>
</body>
</html>
